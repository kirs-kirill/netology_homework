
# Домашнее задание к занятию «Микросервисы: принципы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задача 1: API Gateway 

Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

Решение должно соответствовать следующим требованиям:
- маршрутизация запросов к нужному сервису на основе конфигурации,
- возможность проверки аутентификационной информации в запросах,
- обеспечение терминации HTTPS.

Обоснуйте свой выбор.

### Ответ

|Поставщик         |Маршрутизация|Аутентификация|HTTPS|Бесплатно/Открыто?   |
|------------------|-------------|--------------|-----|---------------------|
|Kong Gateway      | +           | +            | +   |Бесплатно, Apache 2.0|
|HAProxy           | +           | +            | +   |Бесплатно            |
|Yandex API Gateway| +           | +            | +   |Платно               |
|Azure API Gateway | +           | +            | +   |Платно               |
|NGINX             | +           | +            | +   |Бесплатно            |
|Apache APISIX     | +           | +            | +   |Бесплатно, Apache 2.0|

По функционалу подходят все варианты. Для небольшого проекта целесообразно использовать облачные API Gateway, например от Яндекса (есть бесплатный объём).

Если требуется развернуть self-hosted API Gateway, то наиболее оптимальным будет NGINX - популярное бесплатное решение, продукт с большим сообществом (можно найти достаточно различных схем реализации API Gateway). Еще можно рассмотреть HAProxy, как более быстрая и универсальная альтернатива.


## Задача 2: Брокер сообщений

Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

Решение должно соответствовать следующим требованиям:
- поддержка кластеризации для обеспечения надёжности,
- хранение сообщений на диске в процессе доставки,
- высокая скорость работы,
- поддержка различных форматов сообщений,
- разделение прав доступа к различным потокам сообщений,
- простота эксплуатации.

Обоснуйте свой выбор.

### Ответ

|Требования\брокер                                    |Apache Kafka|RabbitMQ|Redis|
|-----------------------------------------------------|------------|--------|-----|
|Поддержка кластеризации для обеспечения надёжности   | + | + | + |
|Хранение сообщений на диске в процессе доставки      | + | - | - |
|Высокая скорость работы                              |>1 млн сообщений|~50 тыс. сообщений|~1 млн сообщений|
|Поддержка различных форматов сообщений               | + | + | + |
|Разделение прав доступа к различным потокам сообщений| + | + | + |
|Простота эксплуатации                                | - | + | + |


Мне видится лучшими вариантами Kafka или RabbitMQ. Итоговое решение будет зависеть от того, что является приоритетом, на какие параметры нужно обратить внимание, а какие параметры можно считать второстепенными. Для максимальной производительности можно рассмотреть Kafka. При этом RabbitMQ позволяет подписчикам упорядочивать произвольные группы событий.

Kafka — это распределенная очередь с высокой пропускной способностью, созданная для длительного хранения больших объемов данных. Она идеально подходит в тех случаях, где требуется персистентность.

RabbitMQ — давно известный, популярный брокер со множеством функций и возможностей, поддерживающих сложную маршрутизацию. Он способен обеспечивать такую маршрутизацию сообщений при незначительном трафике (несколько десятков тысяч сообщений в секунду).

